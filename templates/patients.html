<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Patients â€“ Kit & Dom's Dental Clinic</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../static/css/style.css" />
  <link rel="stylesheet" href="../static/css/patients.css" />
</head>

<body>
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <button class="sidebar-toggle" onclick="toggleSidebar()" aria-label="Toggle sidebar">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
      <div class="header-logo">ðŸ¦·</div>
      <div class="header-title" id="pageTitle">Kit & Dom's Dental Clinic</div>
    </div>

    <div class="header-right">
      <div class="user-dropdown" id="userDropdown">
        <button class="user-trigger" onclick="toggleDropdown()" aria-haspopup="true" aria-expanded="false">
          <div class="user-avatar" id="userAvatar">MS</div>
          <div class="user-info">
            <div class="user-name" id="userName">Maria Santos</div>
            <div class="user-role" id="userRole">Manager / Dentist</div>
          </div>
          <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>

        <div class="dropdown-menu" role="menu">
          <button class="dropdown-item" onclick="navigateTo('settings')">My Profile</button>
          <button class="dropdown-item" onclick="navigateTo('settings')">Change Password</button>
          <button class="dropdown-item" onclick="navigateTo('settings')">Account Settings</button>
          <div class="dropdown-divider"></div>
          <button class="dropdown-item" id="logoutBtn" onclick="logout()">Logout</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Sidebar -->
  <nav class="sidebar" id="sidebar" aria-label="Main navigation">
    <a href="#" class="sidebar-item" onclick="navigateTo('dashboard'); return false;">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        <polyline points="9 22 9 12 15 12 15 22"></polyline>
      </svg>
      <span>Dashboard</span>
    </a>
    <a href="#" class="sidebar-item active" onclick="navigateTo('patients'); return false;">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
        <circle cx="9" cy="7" r="4"></circle>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
      </svg>
      <span>Patients</span>
    </a>
    <a href="#" class="sidebar-item admin-only" onclick="navigateTo('staff'); return false;">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
        <circle cx="8.5" cy="7" r="4"></circle>
        <polyline points="17 11 19 13 23 9"></polyline>
      </svg>
      <span>Staff Management</span>
    </a>
    <a href="#" class="sidebar-item admin-only" onclick="navigateTo('logs'); return false;">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="16" y1="13" x2="8" y2="13"></line>
        <line x1="16" y1="17" x2="8" y2="17"></line>
        <polyline points="10 9 9 9 8 9"></polyline>
      </svg>
      <span>Audit Logs</span>
    </a>
    <a href="#" class="sidebar-item admin-only" onclick="navigateTo('backup'); return false;">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
        <line x1="12" y1="22.08" x2="12" y2="12"></line>
      </svg>
      <span>Backup & Restore</span>
    </a>
    <a href="#" class="sidebar-item" onclick="navigateTo('settings'); return false;">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="3"></circle>
        <path d="M12 1v6m0 6v6m4.22-13.22l4.24 4.24M1.54 1.54l4.24 4.24M20.46 20.46l-4.24-4.24M1.54 20.46l4.24-4.24"></path>
      </svg>
      <span>Account Settings</span>
    </a>
  </nav>

  <!-- Main Content -->
  <main class="main-content" id="mainContent">
    <!-- Page Header -->
    <section class="page-header">
      <div>
        <h1 class="page-title">Patient Records</h1>
        <p class="page-subtitle">Manage patient information and medical records</p>
      </div>
    </section>

    <!-- Action Bar -->
    <section class="action-bar">
      <div class="action-bar-left">
        <button class="btn btn-primary" id="addPatientBtn" onclick="openAddPatientModal()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Add New Patient
        </button>
        <button class="btn btn-secondary admin-only" id="exportBtn" onclick="exportPatientsToCSV()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          Export to CSV
        </button>
        <button class="btn btn-secondary admin-only" id="bulkDeleteBtn" onclick="toggleBulkDelete()" style="display:none;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
          Delete Selected
        </button>
      </div>

      <div class="action-bar-right">
        <div class="search-box">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <input type="text" id="searchInput" placeholder="Search by name or ID..." oninput="filterPatients()">
        </div>
      </div>
    </section>

    <!-- Filters -->
    <section class="filters">
      <div class="filter-group">
        <label for="genderFilter">Gender:</label>
        <select id="genderFilter" onchange="filterPatients()">
          <option value="">All</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
          <option value="Other">Other</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="statusFilter">Status:</label>
        <select id="statusFilter" onchange="filterPatients()">
          <option value="">All</option>
          <option value="active">Active</option>
          <option value="inactive">Inactive</option>
        </select>
      </div>

      <button class="btn-text" onclick="resetFilters()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="1 4 1 10 7 10"></polyline>
          <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
        </svg>
        Reset Filters
      </button>
    </section>

    <!-- Patient Table -->
    <section class="table-container">
      <div class="table-wrapper">
        <table class="patient-table" id="patientTable">
          <thead>
            <tr>
              <th class="admin-only" style="width: 40px;">
                <input type="checkbox" id="selectAll" onchange="toggleSelectAll(this)" style="display:none;">
              </th>
              <th>Patient ID</th>
              <th>Full Name</th>
              <th>Gender</th>
              <th>Age</th>
              <th>Contact Number</th>
              <th>Last Visit</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="patientTableBody">
            <!-- Patients will be dynamically loaded here -->
          </tbody>
        </table>
      </div>

      <div class="table-footer">
        <p class="table-info" id="tableInfo">Showing 0 of 0 patients</p>
      </div>
    </section>
  </main>

  <!-- Add/Edit Patient Modal -->
  <div class="modal-overlay" id="patientModal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-labelledby="modalTitle">
      <div class="modal-header">
        <h2 id="modalTitle">Add New Patient</h2>
        <button class="modal-close" onclick="closePatientModal()" aria-label="Close modal">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <form id="patientForm" onsubmit="savePatient(event)">
        <div class="modal-body">
          <input type="hidden" id="patientId" name="id">

          <!-- Basic Information -->
          <div class="form-section">
            <h3 class="form-section-title">Basic Information</h3>

            <div class="form-row">
              <div class="form-group">
                <label for="firstName">First Name <span class="required">*</span></label>
                <input type="text" id="firstName" name="firstName" required>
              </div>

              <div class="form-group">
                <label for="lastName">Last Name <span class="required">*</span></label>
                <input type="text" id="lastName" name="lastName" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="gender">Gender <span class="required">*</span></label>
                <select id="gender" name="gender" required>
                  <option value="">Select Gender</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                  <option value="Other">Other</option>
                </select>
              </div>

              <div class="form-group">
                <label for="dob">Date of Birth <span class="required">*</span></label>
                <input type="date" id="dob" name="dob" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="contact">Contact Number <span class="required">*</span></label>
                <input type="tel" id="contact" name="contact" placeholder="09171234567" required>
              </div>

              <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" placeholder="patient@email.com">
              </div>
            </div>

            <div class="form-group">
              <label for="address">Address</label>
              <textarea id="address" name="address" rows="2" placeholder="Complete address"></textarea>
            </div>
          </div>

          <!-- Medical Information (Manager only) -->
          <div class="form-section admin-only">
            <h3 class="form-section-title">Medical Information</h3>

            <div class="form-group">
              <label for="allergies">Allergies</label>
              <input type="text" id="allergies" name="allergies" placeholder="e.g., Penicillin, Latex">
            </div>

            <div class="form-group">
              <label for="conditions">Medical Conditions</label>
              <input type="text" id="conditions" name="conditions" placeholder="e.g., Hypertension, Diabetes">
            </div>

            <div class="form-group">
              <label for="medications">Current Medications</label>
              <input type="text" id="medications" name="medications" placeholder="e.g., Losartan 50mg">
            </div>

            <div class="form-group">
              <label for="notes">Dentist Notes</label>
              <textarea id="notes" name="notes" rows="3" placeholder="Additional notes..."></textarea>
            </div>
          </div>

          <!-- Additional (Manager only) -->
          <div class="form-section admin-only">
            <h3 class="form-section-title">Additional Information</h3>

            <div class="form-row">
              <div class="form-group">
                <label for="assignedDentist">Assigned Dentist</label>
                <select id="assignedDentist" name="assignedDentist">
                  <option value="">Select Dentist</option>
                  <option value="Dr. Maria Santos">Dr. Maria Santos</option>
                  <option value="Dr. John Reyes">Dr. John Reyes</option>
                  <option value="Dr. Anna Cruz">Dr. Anna Cruz</option>
                </select>
              </div>

              <div class="form-group">
                <label for="status">Status</label>
                <select id="status" name="status">
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closePatientModal()">Cancel</button>
          <button type="submit" class="btn btn-primary" id="savePatientBtn">Save Patient</button>
        </div>
      </form>
    </div>
  </div>

  <!-- View Patient Modal -->
  <div class="modal-overlay" id="viewPatientModal" aria-hidden="true">
    <div class="modal-content modal-lg" role="dialog" aria-labelledby="viewModalTitle">
      <div class="modal-header">
        <h2 id="viewModalTitle">Patient Details</h2>
        <button class="modal-close" onclick="closeViewPatientModal()" aria-label="Close modal">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <div class="tabs">
          <button class="tab-btn active" onclick="switchTab('personal')">Personal Info</button>
          <button class="tab-btn admin-only" onclick="switchTab('medical')">Medical History</button>
          <button class="tab-btn" onclick="switchTab('visits')">Visit History</button>
        </div>

        <!-- Personal Info Tab -->
        <div class="tab-content active" id="personalTab">
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Patient ID:</span>
              <span class="info-value" id="viewPatientId">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">Full Name:</span>
              <span class="info-value" id="viewFullName">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">Gender:</span>
              <span class="info-value" id="viewGender">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">Date of Birth:</span>
              <span class="info-value" id="viewDob">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">Age:</span>
              <span class="info-value" id="viewAge">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">Contact Number:</span>
              <span class="info-value" id="viewContact">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">Email:</span>
              <span class="info-value" id="viewEmail">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">Address:</span>
              <span class="info-value" id="viewAddress">-</span>
            </div>
            <div class="info-item admin-only">
              <span class="info-label">Assigned Dentist:</span>
              <span class="info-value" id="viewDentist">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">Status:</span>
              <span class="info-value" id="viewStatus">-</span>
            </div>
          </div>
        </div>

        <!-- Medical History Tab -->
        <div class="tab-content admin-only" id="medicalTab">
          <div class="info-grid">
            <div class="info-item full-width">
              <span class="info-label">Allergies:</span>
              <span class="info-value" id="viewAllergies">-</span>
            </div>
            <div class="info-item full-width">
              <span class="info-label">Medical Conditions:</span>
              <span class="info-value" id="viewConditions">-</span>
            </div>
            <div class="info-item full-width">
              <span class="info-label">Current Medications:</span>
              <span class="info-value" id="viewMedications">-</span>
            </div>
            <div class="info-item full-width">
              <span class="info-label">Dentist Notes:</span>
              <span class="info-value" id="viewNotes">-</span>
            </div>
          </div>
        </div>

        <!-- Visit History Tab -->
        <div class="tab-content" id="visitsTab">
          <div id="visitHistory">
            <p class="text-muted">No visit history available.</p>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeViewPatientModal()">Close</button>
        <button type="button" class="btn btn-primary" onclick="editPatientFromView()">Edit Patient</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" id="deleteModal" aria-hidden="true">
    <div class="modal-content modal-sm" role="dialog">
      <div class="modal-header">
        <h2>Confirm Delete</h2>
        <button class="modal-close" onclick="closeDeleteModal()" aria-label="Close modal">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <p>Are you sure you want to delete <strong id="deletePatientName"></strong>?</p>
        <p class="text-muted">This action cannot be undone.</p>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
        <button type="button" class="btn btn-danger" onclick="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>

  <footer class="footer">Â© 2025 Kit & Dom's Dental Clinic | Version 1.0</footer>

  <!-- Load JS files in order -->
  <script src="../static/js/auth.js"></script>
  <script src="../static/js/main.js"></script>
  <script src="../static/js/patients.js"></script>
</body>
</html>
